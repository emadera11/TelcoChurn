---
title: "Customer Churn Analysis"
output: 
    html_document:
        smart: false
---

Loading the necessary pacakges for this analysis: 

```{r messages=FALSE}

library(dplyr)
library(psych)
library(tidyr)
library(ggplot2)
library(rpart)
library(rpart.plot)
library(caTools)
library(randomForest)
library(knitr)
library(rmarkdown)
library(markdown)
library(kableExtra)
library(gridExtra)


```
For this analysis i will predict customer churn using Logistic Regression, Decision Tree and Random Forest.   Data background information: 
THe data contains customer information such as if the customer is senior citizen, which product are they current enroll, 
monthly charges and total charges, amoung other variables that might be important for our prediction.  

The below tables contains information on what is stored in each variable.  This gives us the ability to guage 
on what the content of the data.   

```{r echo=FALSE} 
options(knitr.table.format = "html")
df  = read.csv("D:\\Emman\\Documents\\GitHub\\TelcoChurn\\ChurnAnalysis\\ChurnAnalysis\\datasource\\customerchurn.csv", na.strings = c("", "NA"))

kable(head(df)) %>%
     kable_styling(bootstrap_options = "striped",
                full_width = F) %>%
             scroll_box(width='100%')

```


Below table shows the description of each variable.    before we move further to clean the data and prepare the data for our models 
lets explore the data.   Below I used the summary function to describe the contents of the data.


```{r}
summary(df)                                                                  
```

<h2>Data Visualization and Exploration</h2>

The below Histograms represent the distribution of the MonthlyCHarges, TotalCharges and Tenure.  

<ul>
    <li>MonthlyCharges: The distribution for this data as we can visualize it does not come from a normal distirbution.  We can do a statistical test and hypothize the normality of the data. </li></br>
    <li>TotalCharges: This data is heavily right skewed we can conclude that this data does not come from a normal distribution.</li></br>
    <li>Tenure: This data does not come from a normal distribution. We can perform a statistical analysis to determine the normality of this data. </li>

</ul>

```{r fig.width=20, fig.height=7}

a = ggplot(df, aes(MonthlyCharges)) +
    geom_histogram(color = "black", fill = "red", binwidth = 15, alpha = 0.5) +
    theme_bw()

b = ggplot(df, aes(TotalCharges)) +
    geom_histogram(color = "black", fill = "blue", alpha = 0.5, binwidth = 500) +
    theme_bw()

c = ggplot(df, aes(tenure)) +
    geom_histogram(color = "black", fill = "green", alpha = 0.5, binwidth = 5) +
    theme_bw()

grid.arrange(a, b, c, ncol=3)
```

```{r}
```


The below chart shows the averages Total Monthly Charges by Tenure and Contract.  
As we can see Month to Month and one Year contract have a strong linear corralation .  For the two year Contract
There is a strong linear corralation but is not as strong as the other two contracts.  As the tenure months increase the average monthly charges tends to increase as well. 

The boxplot shows that the average for monthly charges are closed for being equal.  We can use analysis of anavo to test the hypothesis that the mean are equal for the contracts.  
Boxplot are also used to detect outliers from the boxplot below it appears that there aren't any visible outliers.  I will perform a statistical analysis for outlier detection.

```{r fig.width=20, fig.height=7} 
d = df %>% group_by(Contract, tenure) %>%
    summarise(AvgMonthly = mean(MonthlyCharges)) %>%
    ggplot(aes(tenure, AvgMonthly, color = Contract)) + #, group = Contract)) +
    geom_point(size=3) +
    ggtitle("Average Monthly Charges By Tenure") +
    theme_bw()

e = ggplot(df, aes(factor(Contract), MonthlyCharges, fill = factor(Contract))) +
    geom_boxplot() +
    theme_bw() +
    ggtitle("Boxplot for Contract nd Monthly Charges")

grid.arrange(d, e, ncol = 2)

```

```{r}
for (i in names(df)) {
    if (is.factor(df[, i]) == TRUE) {
        df[, i] = as.factor(ifelse(as.character(df[, i]) == "No internet service" | as.character(df[, i]) == "No phone service", "No", as.character(df[, i])))

    }
}

summary(df)
```